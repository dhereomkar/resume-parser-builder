<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Build Resume</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <header class="site-header">
    <a class="brand" href="index.html">
      <div class="logo">RB</div>
      <div>
        <div style="font-weight:600">Resume Builder</div>
        <div style="font-size:12px;color:var(--muted)">Edit & preview</div>
      </div>
    </a>
    <nav>
      <a class="btn" href="upload.html">Upload</a>
    </nav>
  </header>

  <main class="container">
    <div class="form card">
      <h2 style="margin-top:0">Edit Your Details</h2>

      <label for="name">Full name</label>
      <input id="name" placeholder="Full Name">

      <label for="email">Email</label>
      <input id="email" placeholder="Email">

      <label for="phone">Phone</label>
      <input id="phone" placeholder="Phone">

      <label for="skills">Skills (comma separated)</label>
      <textarea id="skills" placeholder="Skills"></textarea>

      <label for="education">Education</label>
      <textarea id="education" placeholder="Education"></textarea>

      <label for="experience">Experience</label>
      <textarea id="experience" placeholder="Experience"></textarea>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center">
        <label for="templateSelect" style="margin:0;font-size:13px;color:var(--muted)">Template</label>
        <select id="templateSelect" style="max-width:160px">
          <option value="1">Template 1 — Classic</option>
          <option value="2">Template 2 — Compact</option>
          <option value="3">Template 3 — Modern</option>
        </select>
        <button id="renderBtn" class="btn">Render</button>
        <button id="downloadBtn" class="btn outline">Download PDF</button>
      </div>
    </div>

    <div class="preview card" id="output">
      <h3 style="margin-top:0">Resume Preview</h3>
      <div class="status">Your resume will appear here...</div>
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script>
    const fields = ['name','email','phone','skills','education','experience'].reduce((acc,id)=>{
      acc[id]=document.getElementById(id); return acc;
    },{});
    const output = document.getElementById('output');

    const data = JSON.parse(localStorage.getItem('resumeData')||'null');
    if (data) {
      if (data.name) fields.name.value = data.name;
      if (data.email) fields.email.value = data.email;
      if (data.phone) fields.phone.value = data.phone;
    }

    function renderTemplate(r, t){
      if (t===1){
        return `\n          <div class="box">\n            <h2 style="margin:0">${r.name}</h2>\n            <p style="color:var(--muted)">${r.email} • ${r.phone}</p>\n            <hr>\n            <h4>Skills</h4><p>${r.skills}</p>\n            <h4>Education</h4><p>${r.education}</p>\n            <h4>Experience</h4><p>${r.experience}</p>\n          </div>`;
      }
      return `\n        <div class="box">\n          <h1 style="margin:0">${r.name}</h1>\n          <p><strong>Email:</strong> ${r.email}</p>\n          <p><strong>Phone:</strong> ${r.phone}</p>\n          <p><strong>Skills:</strong> ${r.skills}</p>\n          <p><strong>Education:</strong> ${r.education}</p>\n          <p><strong>Experience:</strong> ${r.experience}</p>\n        </div>`;
    }

    function gather(){
      return {
        name: fields.name.value || '',
        email: fields.email.value || '',
        phone: fields.phone.value || '',
        skills: fields.skills.value || '',
        education: fields.education.value || '',
        experience: fields.experience.value || ''
      };
    }

    document.getElementById('renderBtn').addEventListener('click',()=>{
      const t = parseInt(document.getElementById('templateSelect').value,10) || 1;
      output.innerHTML = renderTemplate(gather(), t);
    });

    // Load saved data and render default preview
    if (!output.querySelector('.box')) {
      output.innerHTML = renderTemplate(gather(), 1);
    }

    // PDF download using html2pdf (cdn)
    document.getElementById('downloadBtn').addEventListener('click', async ()=>{
      const t = parseInt(document.getElementById('templateSelect').value,10) || 1;
      output.innerHTML = renderTemplate(gather(), t);
      const element = output.querySelector('.box') || output;
      const name = (fields.name.value || 'resume').trim().replace(/\s+/g,'_') + '.pdf';
      try {
        // html2pdf options
        const opt = {
          margin:       0.4,
          filename:     name,
          image:        { type: 'jpeg', quality: 0.98 },
          html2canvas:  { scale: 2, useCORS: true },
          jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        // html2pdf is loaded via CDN script included below
        html2pdf().set(opt).from(element).save();
      } catch (err) {
        alert('Could not generate PDF. Try refreshing the page.');
      }
    });
  </script>

</body>
</html>
